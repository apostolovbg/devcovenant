header_lines:
- '# DevCovenant Development Plan'
- '**Last Updated:** 2026-02-07'
- '**Version:** 0.2.6'
doc_id: PLAN
doc_type: plan
managed_by: DevCovenant
managed_block: |-
  **Doc ID:** PLAN
  **Doc Type:** plan
  **Managed By:** DevCovenant
body: |-
  <!-- DEVCOV:BEGIN -->
  **Doc ID:** PLAN
  **Doc Type:** plan
  **Managed By:** DevCovenant
  <!-- DEVCOV:END -->

  The goal of this plan is to walk through the remaining work required to
  fully satisfy the specification in `SPEC.md`. The specification itself is
  our single source of truth; this plan tracks every outstanding SPEC item,
  orders them by dependency, and highlights what is already done so we do not
  duplicate effort.

  Every completed item is explicitly marked with `[done]` in the section where
  it appears. Items that remain work-in-progress keep the `[not done]` marker
  so reviewers immediately see what still blocks a release. When a bullet
  moves to `[done]`, update the description so the plan stays an accurate
  trace.

  ## Table of Contents
  1. [Overview](#overview)
  2. [Spec compliance summary](#spec-compliance-summary)
  3. [Outstanding work (dependency order)](#outstanding-work-dependency-order)
  4. [Execution notes](#execution-notes)
  5. [Testing and validation](#testing-and-validation)
  6. [Release readiness](#release-readiness)

  ## Overview
  - Treat `SPEC.md` as the authoritative specification and keep this plan in
    sync with every SPEC requirement.
  - Mirror the `devcovenant/` structure under `tests/` as mandated by SPEC, but
    keep the runtime suites under `tests/devcovenant/` so they can remain
    outside the installable package.
  - Drive configuration, registries, and managed docs from profile metadata so
    all knobs, selectors, and assets flow from the active profiles.
  - Install/deploy/update/upgrade/refresh follow the lifecycle model: `install`
    writes a generic config stub, `deploy` activates docs/assets, `update`
    refreshes managed content without touching core files, `upgrade` explicitly
    replaces core files, and `refresh` is registry-only. `undeploy` removes
    managed blocks while keeping core + config; `uninstall` removes everything.
  - Documentation defaults to `devcovenant --help` examples while mentioning
    `python3 -m devcovenant --help` once per doc as the fallback.

  ## Spec compliance summary
  This section enumerates each major SPEC chapter with its completion status.
  It is the checklist we consult before declaring the spec satisfied.

  ### Workflow
  - [done] Gated workflow: `pre-commit start`, tests (`pytest` +
    `python3 -m unittest discover`), and `pre-commit end` are required for every
    change.
  - Clarify that the start gate only needs to execute before edits; it may detect
    outstanding violations and does not have to leave a clean tree.
  - Start recorded after edits now yields a warning (with a brief pause) instead
    of blocking, but a clean `start → tests → end` run is still required to
    clear the gate.
  - [done] Startup check (`python3 -m devcovenant check --mode startup`).
  - [done] Policy edits run `devcovenant update-policy-registry` after
    updating scripts/tests so hashes stay aligned.
  - [done] Every change gets logged into `CHANGELOG.md`.
    Record it under the current version entry.

  ### Functional requirements
  - [done] Emit resolved policy metadata (policy defaults → profile overlays
    → config overrides) into AGENTS and the policy registry for every policy.
    Include every common key and policy-specific key (even when empty), keep the
    policy list alphabetical, and manage the policy block so users never edit it
    directly.
  - [done] Follow the policy module/adapters/fixer loading rules described
    in SPEC.
  - [done] Respect `enabled`, `severity`, `status`, and `enforcement` metadata.
    Apply those settings across all policies.
  - [done] Collapse execution into two modes: `audit` (no auto-fix) and `fix`
    (auto-fix permitted). Both share the same policy set and exit non-zero on
    blocking violations or sync issues.
  - [done] Provide both `devcovenant` console entry and `python3 -m devcovenant`
    module entry, with docs defaulting to the console path.
  - [done] `test` runs `pytest` + `python3 -m unittest discover` while respecting
    the `tests/devcovenant/` layout and keeping those suites out of packages.
  - [done] `check` exits non-zero when blocking violations exist (audit/fix
    modes).
  - [done] Metadata normalization handled by refresh/update; no separate
    `normalize-metadata` command needed.
  - [done] `refresh-all` regenerates `.gitignore` from profile fragments while
    preserving any user-provided entries.
  - [done] `refresh-all` rebuilds registries/metadata without touching managed
    docs; doc syncing moves to install/update or a docs refresh path.
  - [done] CLI emits stage banners and status steps (registry refresh, engine
    init, command execution) for traceable runs without flooding output.
  - [not done] Lifecycle commands match SPEC: `install` writes a generic config
    stub and may prompt `upgrade`, `deploy` activates docs/assets, `update`
    refreshes managed content without core changes, `upgrade` replaces core
    explicitly, `refresh` is registry-only, `undeploy` removes managed blocks,
    and `uninstall` removes the core footprint.
  - [done] Backups are opt-in via `--backup-existing`; default runs overwrite
    files in-place without creating `*_old.*` copies.
  - [done] Version tracking defaults live in profiles: `global` points at
    `VERSION` plus the core doc set, while `devcovrepo` overrides the
    version file to `devcovenant/VERSION`.
  - [not done] Every managed doc must include `Last Updated`/`Version` headers.
    Ensure each file also has top-of-file managed blocks.
    Include `Doc ID`, `Doc Type`, and owner metadata in those blocks.
  - [not done] Documentation examples and running instructions mention `python3`.
    Mention the module entry whenever you discuss source-based usage.
  - [not done] `devcovenant/README.md` includes the packaged
    `DevCovenant Version` value.
  - [done] Managed documents are generated from YAML assets.
    Inject stock non-managed text only when the target doc is missing, empty, or
    a single-line placeholder.
    Otherwise install/update commands refresh just the managed blocks while
    handling the `<!-- DEVCOV-POLICIES -->` block separately.

  ### Policy requirements
  - [done] Policy metadata normalization emits a single resolved metadata
    map (no schema/value split) while keeping existing policy text intact.
  - [done] `changelog-coverage` enforces one fresh entry per change (dated
    today, Change/Why/Impact summary lines each containing an action verb,
    `Files:` block listing only touched paths) and keeps entries newest-first.
  - [done] Runtime state lives under `devcovenant/registry/local`; the legacy
    `.devcov-state` directory is removed.
  - [done] Ship `devcovenant/docs/` as user-facing guides in the package.
  - [done] `dependency-license-sync` uses profile/config overlays to supply
    dependency manifests; the core policy metadata stays general and the
    devcovrepo profile declares DevCovenant’s dependency files.
  - [done] Built-in policies have canonical text in
    `devcovenant/registry/global/stock_policy_texts.yaml`.
  - [done] Custom policy `readme-sync` enforces the README mirroring
    and repo-only block stripping.
  - [done] `devcov-parity-guard` replaces the old stock-policy text check and
    compares AGENTS policy text to descriptor YAML prose for core and custom
    policies.
  - [done] Policy replacement metadata from
    `devcovenant/registry/global/policy_replacements.yaml` is applied.
    Replaced policies move to `custom/` with `custom: true` and are marked
    deprecated when enabled.
  - [not done] The collective `<!-- DEVCOV-POLICIES:BEGIN -->`/
    `<!-- DEVCOV-POLICIES:END -->` block is treated as a managed unit and
    refreshed from assets. A per-policy `freeze` override copies scripts to
    `devcovenant/custom/` and reruns `devcovenant update-policy-registry` when
    toggled.
  - [done] `devcovenant/registry/local/policy_registry.yaml` is the
    sole hash store. The legacy `registry.json` and `update_hashes.py` helper
    have been retired and removed; the registry now records hashes, asset
    hints, profile scopes, core/custom origins, and resolved metadata.
  - [done] Record update notices (replacements/new stock policies) inside
    `devcovenant/registry/local/manifest.json` and print them during updates.
  - [not done] `managed-environment` remains off by default.
    Warn when required metadata or command hints are absent.
  - [done] Dogfood-only policies (`patches-txt-sync`, `gcv-script-naming`,
    `security-compliance-notes`) are removed from the DevCovenant repo.
  - [done] Reduced the stock profile registry to a slim, maintained set
    (global, docs, data, suffixes, python, javascript, typescript, java, go,
    rust, php, ruby, csharp, sql, docker, terraform, kubernetes, fastapi,
    frappe, dart, flutter, swift, objective-c) and updated
    PROFILE_MAP/POLICY_MAP/SPEC to describe the change. Retired stacks are to be
    reintroduced only as custom profiles.
  - [done] Materialize expanded POLICY_MAP/PROFILE_MAP expectations: ensure
    profiles/policies/assets/adapters/fixers match the reference maps and keep
    the maps authoritative for future additions.
  - [done] Align POLICY_MAP scopes with retained profiles: add fastapi,
    frappe, objective-c, and sql where supported (dependency-license-sync,
    docstring-and-comment-coverage, name-clarity, new-modules-need-tests,
    security-scanner, documentation-growth-tracking, line-length-limit,
    version-sync) and trim deprecated stacks (kotlin/scala/groovy/dotnet/
    fsharp/elixir/erlang/haskell/clojure/julia/ocaml/crystal/ansible).
  - [done] Per-profile descriptors (`<profile>.yaml`) must be populated manually
    (maps are reference only); stubs have been fleshed out with real assets and
    overlays for the retained registry.
  - [done] Profile-first scoping: policies run only when a profile lists them
    (including `global`, which now activates all global policies explicitly).
    Policy `profile_scopes` stay as documentation only. Profiles are
    explicit—no inheritance; each profile lists its own assets, suffixes,
    policies, and overlays. Custom policies remain opt-in via custom profiles
    or config overrides (not implicitly active in `global`).

  ### Policy metadata redesign
  - [done] Define per-policy YAML descriptors that include the managed
    prose, selector metadata, and a `metadata` block whose keys describe the
    schema while also supplying the baseline values that feed into AGENTS and
    the registry. The canonical schema no longer lives in a separate
    hand-written file; it is inferred from the keys declared inside each
    policy’s `metadata`.
  - [not done] Use provenance (core vs. frozen/custom loading path) to derive
    `custom`/`enabled`/`freeze` in the generated metadata instead of retaining
    explicit `status` or `updated` keys. `metadata` may still expose knobs such
    as `profile_scopes`, `selector_roles`, or `enforcement`, while the generator
    records the final `enabled`/`freeze`/`severity` values after applying
    overrides.
  - [done] Introduce config keys `autogen_disable`,
    `manual_force_enable`, `freeze_core_policies`, and
    `user_metadata_overrides` so the active profile can flip `enabled`/`freeze`
    and mutate `enforcement`, `severity`, selectors, or any schema value without
    editing the policy YAMLs. The refresh command merges those lists/maps before
    emitting AGENTS and registry entries so docs remain declarative.
  - [done] Record every policy in
    `devcovenant/registry/local/policy_registry.yaml` with a single resolved
    metadata map (no schema/value split). The generator and AGENTS templating
    read from that unified source so enforcement always matches the registry.
  - [done] When DevCovenant removes a core policy, copy it into
    `devcovenant/custom/policies/` (or a frozen overlay prescribed in config),
    mark the new entry as `custom`, and rerun `update-policy-registry` so all
    downstream artifacts report the deprecation rather than leaving dangling IDs.
  - [done] Scope `raw-string-escapes` to the python profile and default it to
    `enabled: false` via the python profile’s `autogen_disable` list.
    Add the repo-only `devcov-raw-string-escapes` custom policy for
    DevCovenant’s own enforcement.

  ### Installation & documentation
  - [not done] Implement the lifecycle commands per SPEC: `install`, `deploy`,
    `update`, `upgrade`, `refresh`, `undeploy`, and `uninstall`.
  - [not done] `install` always runs, writes a generic config stub, and prompts
    to `upgrade` when a newer core exists (never deploys docs/assets).
  - [not done] `deploy` requires a non-generic config and materializes managed
    docs/assets/registries, then runs `refresh`.
  - [not done] `update` refreshes managed content without touching core files.
  - [not done] `upgrade` replaces core files and applies policy replacements,
    then runs `update`.
  - [not done] `refresh` is registry-only and runs inside deploy/update.
  - [not done] `undeploy` removes managed blocks/registries while keeping core.
  - [not done] `uninstall` removes DevCovenant core plus managed blocks.
  - [not done] `update` regenerates policy blocks from descriptors plus
    overrides (no manual edits) without requiring extra CLI flags.
  - [done] Introduce a registry-only refresh mode that regenerates
    `devcovenant/registry/local/*` (hashes, manifest, resolved metadata) and
    re-materializes `config.yaml` only when missing, while skipping AGENTS and
    managed docs. Run this registry-only refresh automatically at the start of
    every devcovenant invocation (including CI) so state is rebuilt without
    dirtying working trees. Policy blocks are fully managed by refresh.
  - [done] `refresh-all` now refreshes config autogen sections (profiles block,
    core paths, and metadata overlays) while preserving user overrides.
  - [not done] `AGENTS.md` always regenerates from the managed template and
    resolved metadata. Preserve the `# EDITABLE SECTION` text when it already
    exists; never allow manual edits in the policy block.
  - [not done] `README.md`, `SPEC.md`, `PLAN.md`, `CHANGELOG.md`, and
    `CONTRIBUTING.md` sync from YAML assets with new managed blocks.
  - [not done] `SPEC.md`/`PLAN.md` rebuild when missing.
    Keep user edits otherwise.
  - [not done] `deploy`/`update` regenerate only managed doc headers and
    managed blocks (UTC dates) while preserving user content outside those
    blocks; `refresh` skips docs entirely.
  - [not done] Version file creation prefers an existing configured version
    file (default `VERSION`, devcovrepo override), then `pyproject.toml`.
    Prompt (default `0.0.1`). `--version` overrides detection.
  - [not done] `LICENSE` falls back to the GPL-3.0 template when missing.
  - [not done] `.gitignore` is rebuilt from fragments while merging user entries.
  - [not done] Every managed doc gets its `Last Updated` header stamped in UTC.
  - [done] `devcovenant/config.yaml` is generated only when missing; autogen
    sections are marked and refreshed while user overrides stay intact so
    installs from existing configs remain possible. Keep the repo’s tracked
    config available for CI, but exclude it from built artifacts via
    `MANIFEST.in` so packages do not ship the repo config.
  - [not done] Config exposes `devcov_core_include`, `devcov_core_paths`, and
    `doc_assets` with `profiles.generated.file_suffixes`.
  - [not done] Profile and policy assets live under `core/` and `custom/`.
    Registry entries go to `devcovenant/registry/local/profile_registry.yaml`.
    Policy asset entries are read directly from policy descriptors.
  - [done] Profile-driven pre-commit config turns profile YAML fragments
    into the generated hook set (global owns the DevCovenant hook baseline, no
    user-managed `.pre-commit-config.yaml`), applies profile exclusions, and
    documents the “Pre-commit config refactor” phase.
  - [done] Ensure the custom `devcovrepo` profile treats `devcovenant/docs`
    as part of the documentation growth tracking surface and ships a
    starter doc (`devcovenant/docs/README.md`) via profile assets so the
    folder grows with useful content and documents how to use overrides and
    custom policies.
  - [not done] Describe how `devcovuser`/`devcovrepo` metadata control the
    `tests/devcovenant/**` mirror: `devcovuser` (user installs) mirrors only
    `devcovenant/custom/**`; when `devcov_core_include` is true (DevCovenant’s
    own repo), disable `devcovuser` entirely and let `devcovrepo` mirror the
    full `devcovenant/**` tree.
  - [done] Exclude vendored code from `devcovuser` by default (`vendor`,
    `third_party`, `node_modules`) so user installs avoid scanning bundled
    dependencies.
  - [done] Honor profile `ignore_dirs` in the engine and skip DevCovenant core
    paths in changelog-coverage for `devcovuser` so vendored DevCovenant code
    stays out of user changelog requirements.
  - [not done] Expand `devcovuser` overlays to exclude `devcovenant/**` from
    noise-prone policies (changelog-coverage, version-sync,
    last-updated-placement, documentation-growth-tracking, line-length-limit)
    while explicitly keeping `devcovenant/custom/**` and
    `tests/devcovenant/custom/**` enforced by code-style/security policies.
  - [not done] Test mirroring rules: with `devcovuser` active, mirror only
    `devcovenant/custom/**` into `tests/devcovenant/custom/**`; when
    `devcov_core_include` enables `devcovrepo`, mirror the full
    `devcovenant/**` tree into `tests/devcovenant/**` (no extra
    `tests/devcovenant/tests/` level). Document how refresh/update rebuild these
    mirrors so it’s clear which suites belong to DevCovenant versus the host
    project.
  - [not done] Define how install/update/refresh regenerate `devcovenant/custom`
    and `tests/devcovenant` from core assets while deleting any `devcovrepo`
    prefixed folders/policies and recreating the user-facing `devcovuser` profile
    so repo-specific overrides never ship.
  - [done] Runtime-required artifacts (`devcovenant/registry/local/` entries
    and `devcovenant/registry/local/test_status.json`) are generated from the
    global profile assets, tracked in this repo for CI/builds, excluded from
    packages, and recreated during install/update/refresh when missing.

  - [done] Describe the `devcovuser`/`devcovrepo` profiles and wiring so user
    repos keep `devcovenant/**` out of enforcement while still covering
    `devcovenant/custom/**`.
  - [done] Describe how install/update/refresh regenerate `devcovenant/custom`
    and `tests/devcovenant` while pruning `devcovrepo`-prefixed overrides when
    `devcov_core_include` is false.
  - [done] Document how the `devcovrepo` profile adds `devcovenant/docs` to
    documentation-growth-tracking and how `devcovuser` controls the
    `tests/devcovenant/**` mirror.

  ### Packaging & testing
  - [not done] Ship DevCovenant as a pure-Python package with a console script
    entry.
  - [done] Keep `requirements.*` aligned with `THIRD_PARTY_LICENSES.md` and sync
    `licenses/` (license report + AUTO_LICENSE_SYNC marker) whenever manifests
    change.
  - [done] Publish PyPI classifiers through Python 3.14 (runtime still
    `requires-python >=3.10`).
  - [not done] Run `pytest` and `python3 -m unittest discover`, mirroring the
    `tests/devcovenant/` layout unless `devcov_core_include` unblocks core.

  ## Outstanding work (dependency order)
  Below is every missing SPEC requirement, ordered by dependency.

  1. **Resolved metadata emission.**
     [done] Emit a single resolved metadata map per policy (policy defaults
     → profile overlays → config overrides) into AGENTS and the registry. Ensure
     all common keys and policy-specific keys are present (even when empty), and
     keep the policy list alphabetical with `enabled` reflecting activation.
  2. **Policy registry + replacements + `freeze`.**
     [done] Registry entries include hashes, assets, origins, and resolved
     metadata (no schema/value split). Replacements/freeze copies rerun the
     registry refresh so AGENTS and the registry stay aligned with active
     overrides.
  3. **End-phase rerun guarantees.** [done]
     End-phase runs now detect hook or test changes, rerun tests and hooks
     until no new diffs appear, and only record `pre_commit_end_*` after a
     stable pass.
  4. **Managed document asset generation.** [done]
     YAML assets must supply full doc structure (including
     `devcovenant/README.md`). Install/update should inject stock text only when
     missing/placeholder, and refresh-all must avoid managed docs.
  5. **Doc asset stamping & last-updated auto-fixer.** [done]
     Auto-fix must stamp UTC `Last Updated` across managed docs and keep
     `Version` headers aligned, while avoiding non-allowlisted files.
  6. **Documentation sync & readme-sync policy.** [done]
     Keep `devcovenant/README.md` mirroring `/README.md` with auto-fixes.
  7. **Lifecycle command matrix (install/deploy/update/upgrade/refresh).**
     Implement `install`, `deploy`, `update`, `upgrade`, `refresh`, `undeploy`,
     `uninstall`, and `reset-to-stock` per SPEC.
     Include policy and docs overrides plus CLI mode distinctions.
  8. **Config & profile asset generation.** [done]
     Config now seeds from the `devcovuser` profile asset (when missing),
     carries doc-asset knobs, and install/update/refresh recreate
     `devcovenant/custom`, rebuild `tests/devcovenant/custom` mirrors, and
     prune `devcovrepo` overrides unless `devcov_core_include` is true.
  9. **Profile-driven pre-commit config.** [done]
     Store hook fragments in profile YAMLs, merge them with config overrides,
     and record metadata. Global provides the DevCovenant hook baseline, profile
     exclusions carry into the generated config, and the generated
     `.pre-commit-config.yaml` is refreshed on deploy/update/upgrade/refresh
     (no user-managed file).
  10. **CLI command placement cleanup.**
     Keep CLI helpers inside `devcovenant/`, expose the standard commands.
  11. **Testing infrastructure.**
     Mirror `tests/devcovenant/` to the package layout and respect the
     `new-modules-need-tests` policy exclusions.
  12. **Packaging & licensing guardrails.**
     [done] Switch DevCovenant to MIT (assets, docs, PyPI metadata).
     Build artifacts with assets, enforce MIT when needed, and sync licensing
     notices.
  13. **Legacy debris cleanup.**
     Remove obsolete artifacts (e.g., `devcovenant/registry.json` and the
     unused GPL license asset) from the tree, update manifests/install lists,
     and drop policy/schema references so refresh/install no longer expect them.
  14. **Profile maps → profile descriptors.**
      Keep core profile YAMLs as the shipped source of truth; `PROFILE_MAP.md`
      / `POLICY_MAP.md` are reference tables for authors to manually populate
      policies, suffixes, assets, and overlays. Descriptors stay named
      `<profile>.yaml`; refresh does not re-materialize maps into manifests.
  15. **Registry/metadata cleanup.**
      Emit a single resolved metadata map in the policy registry (no
      schema/value split). Move broad suffix/prefix/glob defaults out of base
      policies into profile overlays (python/docs/lang-specific and devcovrepo).
      Audit remaining policies for hard-coded metadata that should live in
      profiles instead.

  ## Execution notes
  - Move completed SPEC bullets to `[done]` with a short note.
  - List remaining work in “Outstanding work” by dependency.
  - Keep README/AGENTS/SPEC docs current and let the fixer bump “Last
    Updated”.

  ## Testing and validation
  - Run `devcovenant.run_pre_commit --phase start`, `devcovenant.run_tests`,
    and `devcovenant.run_pre_commit --phase end` for every change.
  - `run_tests` should execute the active `devflow-run-gates.required_commands`
    (from profiles/config) so mixed stacks get all required suites recorded.
  - Write `devcovenant/registry/local/test_status.json` before the final
    pre-commit phase.
  - Run `python3 -m devcovenant check --fix` when doc assets or `last-updated`
    are modified.

  ## Outstanding work
  - Extract language-specific logic from docstring-and-comment-coverage,
    name-clarity, new-modules-need-tests, and security-scanner into adapters
    (`devcovenant/core/policies/<policy>/adapters/<lang>.py`) and keep core
    policy modules language-agnostic.
  - Build adapters for other languages listed in POLICY_MAP scopes (beyond
    python) or trim scopes to the languages we actually support to avoid false
    coverage claims.

  ## Release readiness
  - Confirm `manifest.json` logs layout, docs, and UTC timestamp before release.
  - Verify `CHANGELOG.md` reflects the current version.
    Ensure `no-future-dates` passes.
  - Build artifacts (`python -m build`, `twine check dist/*`) and publish with
    `PYPI_API_TOKEN` once prerequisites are met.
